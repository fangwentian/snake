<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greedy Snake</title>
    <style>
        #canvas {
            background-color: black;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="800" height="800"></canvas>
    <script>
        let speed = 100,
            snake = [ 42, 41 ],
            food = 43, 
            direction = 'right',
            keycodeMap = { 37: 'left', 38: 'up', 39: 'right', 40: 'down' },
            step = 1,
            stepMap = { left: -1, up: -40, right: 1, down: 40 },
            ctx = document.getElementById('canvas').getContext('2d');

        document.addEventListener('keydown', (e) => {
            const { keyCode } = e
            let direction =  keycodeMap[keyCode]
            step = direction ? stepMap[direction] : step
        })

        // 800 * 800的画布，横向纵向是 800/20 = 40个格子, 总共是0 - 1599个
        let draw = (position, color) => {
            ctx.fillStyle = color;
            ctx.fillRect( position % 40 * 20 + 1, Math.floor(position / 40) * 20 + 1, 18, 18 )
        }

        let createFood = () => {
            return food = Math.floor(Math.random() * 1600)
        }

        let isDead = (next) => {
            if(
                next < 0 ||
                next > 1600 ||
                snake.indexOf(next, 1) != -1 ||
                step == 1 && next % 40 === 0 ||
                step == -1 && next % 40 === 39
            ) {
                return true
            }
            return false
        }

        let task = () => {
            snake.unshift(snake[0] + step)
            let next = snake[0]
            if(isDead(next)) {
                alert('Game Over')
            }
            draw(next, 'green')

            if(next === food) {
                while(snake.indexOf(food = createFood()) != -1) {}
                draw(food, 'yellow')
            } else {
                draw(snake.pop(), 'black')
            }
        }

        setInterval(task, speed)
    </script>
</body>
</html>